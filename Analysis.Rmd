---
title: "Queer Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(data.table)
    options(warn=-1)
```



```{r}

d = read_csv('Queer Data fully Cleaned.csv')

for (i in 43:47){
d[,i] <- ifelse(d[,i] == "Extremely comfortable", 5, ifelse(d[,i] == "Somewhat comfortable", 4,ifelse(d[,i] == "Neither comfortable nor uncomfortable", 3,ifelse(d[,i] == "Somewhat uncomfortable", 2,ifelse(d[,i] == "Extremely uncomfortable", 1,NA)))))
d[,i] = as.numeric(as.character(d[[i]]))
}

for(i in 3:21){
  d[,i] = as.numeric(d[[i]])
  
}

d = mutate(d,role = ifelse(grepl("1st",Academic_Class, fixed=TRUE),"Undergraduate",
                           ifelse(grepl("2nd",Academic_Class, fixed=TRUE),"Undergraduate",
                                  ifelse(grepl("3rd",Academic_Class, fixed=TRUE),"Undergraduate",
                                         ifelse(grepl("4th",Academic_Class, fixed=TRUE),
                                                "Undergraduate",
                                                ifelse(grepl("5th+",Academic_Class, fixed=TRUE),
                                                       "Undergraduate",
                                                       ifelse(grepl("Master",Academic_Class,
                                                                    fixed=TRUE),"Graduate",
                                                              ifelse(grepl("PhD",Academic_Class,
                                                                           fixed=TRUE),"Graduate",
                                                                        ifelse(grepl("Staff",Position),"Staff",                                                       ifelse(grepl("Faculty",Position),"Faculty","NA"))))))))))


#Note: Straight includes all gender responses. All "Its complicated" responses are either cis, nonsense, or no answers

#read in the key from the box file
questionKey = read_csv('Question Key.csv')
```


Manually filtered the data using excel and added categories for identity

```{r}
#Filtering Data


d = mutate(d, genderIdentity =ifelse(grepl("Cisgender", Gender, fixed = TRUE), "Cisgender",
                                               ifelse(grepl("Nonbinary", Gender, fixed = TRUE), "Trans/NB",
                                                      ifelse(grepl("Transgender", Gender, fixed = TRUE), "Trans/NB",
                                                             ifelse(grepl("Response", Gender, fixed = TRUE), "Trans/NB","N/A")                                                             ))))


```

Statistics on Queer Student Responses vs others. 

```{r}




```

Statistics on queer only responses:
```{r}




```

All Queer vs Straight Climate T Test 
```{r}

options(warn=-1)

a = d%>%
    group_by(Orientation) %>% 
    summarise_all(mean,na.rm=TRUE)
  b = a[,c(1,4:22)]

  
q = questionKey$col[c(1:19)]
p.vals = numeric()
for (i in q){
t = t.test( d[[i]]~d$Orientation)
p = t$p.value
p.vals[[i]] = p


}
queerps = tibble(Question = questionKey$Question[c(1:19)],Values = p.vals)
queerSig =queerps%>%
  mutate(AllQueer = ifelse(Values < 0.05, Values, "NS")) %>%
  mutate(Values = NULL)
```

All Queer Students T Test

```{r}
  options(warn=-1)
f <- d %>%
  filter(role == "Undergraduate" || role == "Graduate")

a = f%>%
    group_by(Orientation) %>% 
    summarise_all(mean,na.rm=TRUE)
  b = a[c(1,4:22)]

  
q = questionKey$col[c(1:19)]
p.vals = numeric()

for (i in q){
  if(i == "Q4_6"){
    p.vals[[i]] = NA
    next}
  t = t.test( f[[i]]~f$Orientation)
  p = t$p.value
  p.vals[[i]] = p

}
queerp.vals= tibble(Question = questionKey$Question[c(1:19)], Value = p.vals)
queerp.vals = mutate(queerp.vals, Sig = ifelse(Value < 0.05, Value, "NS"))

queerSig$AllStudents  <- queerp.vals$Sig
```


Queer Undergrads t test
```{r}
    options(warn=-1)
f <- d %>%
  filter(role == "Undergraduate")

a = f%>%
    group_by(Orientation) %>% 
    summarise_all(mean,na.rm=TRUE)
  b = a[c(1,4:22)]

  
q = questionKey$col[c(1:19)]
p.vals = numeric()

for (i in q){
  if(i == "Q4_6"){
    p.vals[[i]] = NA
    next}
  t = t.test( f[[i]]~f$Orientation)
  p = t$p.value
  p.vals[[i]] = p

}
queerp.vals= tibble(Question = questionKey$Question[c(1:19)], Value = p.vals)
queerp.vals = mutate(queerp.vals, Sig = ifelse(Value < 0.05, Value, "NS"))

queerSig$UGStudents  <- queerp.vals$Sig


```

Queer Grad Students Sig
```{r}



```



```{r}

g = mutate(f, test = ifelse(grepl("Straight", Orientation, fixed = TRUE ), factor("Straight"), factor("Gay")))

 f$Orientation <- factor(f$Orientation)
```





Anova With Post-Hoc
```{r}
q = questionKey$col[c(1:17,19)]
p.vals = numeric(length(q))
post.hoc = list(length(q))
for (i in q){
r.aov = aov(data = d, d[[i]]~role)
p = summary(r.aov)[[1]][["Pr(>F)"]][1]
p.vals[i] = p
if (p<.05){
 post.hoc[[i]] = pairwise.t.test(d[[i]], d$role, p.adj = "bonferroni")
}
}
a = as_tibble(p.vals)

```




## Including Plots

##You can also embed plots, for example:

##Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
#Writing to excel file to clean
library("xlsx")

write.xlsx(dQueer,file = 'Queer Data For .xlsx',sheetName = 'sheet1',col.names = TRUE, row.names = TRUE)



```
